name: GitHub Actions Build and Deploy Demo
on:
  push:
    branches:
      - main
jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
    
    # - name: Install SSH Client ğŸ”‘
    #   uses: webfactory/ssh-agent@v0.5.4 # This step installs the ssh client into the workflow run. There's many options available for this on the action marketplace.
    #   with:
    #     ssh-private-key: ${{ secrets.AUTHINE_KEY }}

    - name: Checkout
      uses: actions/checkout@main
      
    - name: Install and Build ğŸ”§
      run: |
        yarn
        yarn build

    - name: Deploy gh-pages ğŸš€
      uses: JamesIves/github-pages-deploy-action@4.1.7
      with:
        ssh-key: ${{ secrets.AUTHINE_KEY }}
        branch: gh-pages # The branch the action should deploy to.
        folder: dist 
      
    - name: Deploy app ğŸš€
      uses: JamesIves/github-pages-deploy-action@4.1.7
      with:
        ssh-key: ${{ secrets.AUTHINE_KEY }}
        branch: master # The branch the action should deploy to.
        folder: dist # The folder the action should deploy.
        repository-name: smanx/app #å…è®¸æ‚¨æŒ‡å®šå…¶ä»–å­˜å‚¨åº“è·¯å¾„
        target-folder: atmaster #å¦‚æœè¦å°†éƒ¨ç½²æ–‡ä»¶å¤¹çš„å†…å®¹æ¨é€åˆ°éƒ¨ç½²åˆ†æ”¯ä¸Šçš„ç‰¹å®šç›®å½•ä¸­ï¼Œå¯ä»¥åœ¨æ­¤å¤„æŒ‡å®š
        clean: true #æ¯æ¬¡éƒ¨ç½²æ—¶è‡ªåŠ¨å°†å…¶ä»Deploymentåˆ†æ”¯ä¸­åˆ é™¤
        # single-commit: true #å¦‚æœæ‚¨å¸Œæœ›åœ¨éƒ¨ç½²åˆ†æ”¯ä¸Šè¿›è¡Œä¸€æ¬¡æäº¤è€Œä¸æ˜¯ä¿ç•™å®Œæ•´çš„å†å²è®°å½•
        
    - name: Upload a Build Artifact
      uses: actions/upload-artifact@v2.3.1
      with:
        # Artifact name
        name: package
        # A file, directory or wildcard pattern that describes what to upload
        path: dist